<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序的~坑！！！！ | 小明的docment</title>
    <meta name="description" content="关于小明的文档">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script")
        hm.src = "https://hm.baidu.com/hm.js?6cd2cc405ca7d5f413790a2181ed53e7"
        var s = document.getElementsByTagName("script")[0]
        s.parentNode.insertBefore(hm, s)
      })()
    </script>
    
    <link rel="preload" href="/assets/css/0.styles.46bcc624.css" as="style"><link rel="preload" href="/assets/js/app.d56d54d5.js" as="script"><link rel="preload" href="/assets/js/7.b09efff3.js" as="script"><link rel="prefetch" href="/assets/js/10.1a39355f.js"><link rel="prefetch" href="/assets/js/11.1e415d99.js"><link rel="prefetch" href="/assets/js/12.5e9877fa.js"><link rel="prefetch" href="/assets/js/13.51f68b80.js"><link rel="prefetch" href="/assets/js/14.f38e2984.js"><link rel="prefetch" href="/assets/js/15.61779e81.js"><link rel="prefetch" href="/assets/js/16.b0654b1c.js"><link rel="prefetch" href="/assets/js/17.e7ab0c85.js"><link rel="prefetch" href="/assets/js/18.7e238fc2.js"><link rel="prefetch" href="/assets/js/19.a9f7b991.js"><link rel="prefetch" href="/assets/js/2.0534fa10.js"><link rel="prefetch" href="/assets/js/20.3aad2be6.js"><link rel="prefetch" href="/assets/js/21.4d55085e.js"><link rel="prefetch" href="/assets/js/22.a04f2017.js"><link rel="prefetch" href="/assets/js/23.ed906f1e.js"><link rel="prefetch" href="/assets/js/24.5e680890.js"><link rel="prefetch" href="/assets/js/25.23ef539a.js"><link rel="prefetch" href="/assets/js/26.1a98f261.js"><link rel="prefetch" href="/assets/js/27.4940a424.js"><link rel="prefetch" href="/assets/js/3.c3c01f9a.js"><link rel="prefetch" href="/assets/js/4.c11a2008.js"><link rel="prefetch" href="/assets/js/5.e5b20c49.js"><link rel="prefetch" href="/assets/js/6.da4381e1.js"><link rel="prefetch" href="/assets/js/8.2983a641.js"><link rel="prefetch" href="/assets/js/9.4ecec881.js">
    <link rel="stylesheet" href="/assets/css/0.styles.46bcc624.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小明的docment</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mdRules.html" class="nav-link">md语法</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-element.html" class="nav-link">vue-elementUI</a></li><li class="dropdown-item"><!----> <a href="/blog/demo.html" class="nav-link">demo</a></li><li class="dropdown-item"><!----> <a href="/blog/echarts.html" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/blog/js基础.html" class="nav-link">js基础</a></li><li class="dropdown-item"><!----> <a href="/blog/vuessr.html" class="nav-link">vuessr</a></li><li class="dropdown-item"><!----> <a href="/blog/mini-program.html" class="nav-link router-link-exact-active router-link-active">小程序的坑</a></li><li class="dropdown-item"><!----> <a href="/blog/website.html" class="nav-link">阿里云建站</a></li><li class="dropdown-item"><!----> <a href="/blog/jenkins.html" class="nav-link">jenkins搭建</a></li><li class="dropdown-item"><!----> <a href="/blog/react.html" class="nav-link">react笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/angular.html" class="nav-link">angular笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/h5.html" class="nav-link">H5</a></li><li class="dropdown-item"><!----> <a href="/blog/chrome.html" class="nav-link">chorme</a></li><li class="dropdown-item"><!----> <a href="/blog/mianshi.html" class="nav-link">常见冷知识</a></li><li class="dropdown-item"><!----> <a href="/blog/aa.html" class="nav-link">待整理</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/guangming95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mdRules.html" class="nav-link">md语法</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-element.html" class="nav-link">vue-elementUI</a></li><li class="dropdown-item"><!----> <a href="/blog/demo.html" class="nav-link">demo</a></li><li class="dropdown-item"><!----> <a href="/blog/echarts.html" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/blog/js基础.html" class="nav-link">js基础</a></li><li class="dropdown-item"><!----> <a href="/blog/vuessr.html" class="nav-link">vuessr</a></li><li class="dropdown-item"><!----> <a href="/blog/mini-program.html" class="nav-link router-link-exact-active router-link-active">小程序的坑</a></li><li class="dropdown-item"><!----> <a href="/blog/website.html" class="nav-link">阿里云建站</a></li><li class="dropdown-item"><!----> <a href="/blog/jenkins.html" class="nav-link">jenkins搭建</a></li><li class="dropdown-item"><!----> <a href="/blog/react.html" class="nav-link">react笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/angular.html" class="nav-link">angular笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/h5.html" class="nav-link">H5</a></li><li class="dropdown-item"><!----> <a href="/blog/chrome.html" class="nav-link">chorme</a></li><li class="dropdown-item"><!----> <a href="/blog/mianshi.html" class="nav-link">常见冷知识</a></li><li class="dropdown-item"><!----> <a href="/blog/aa.html" class="nav-link">待整理</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/guangming95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>小程序的~坑！！！！</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/mini-program.html#小程序" class="sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mini-program.html#async-await" class="sidebar-link">async await</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序使用字体图标" class="sidebar-link">小程序使用字体图标</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#wxs-过滤器" class="sidebar-link">wxs 过滤器</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#wxs-时间格式化-过滤器-兼容ios" class="sidebar-link">wxs 时间格式化 过滤器 兼容ios</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#newdate-在ios-问题" class="sidebar-link">newDate()  在ios 问题</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#使小程序自动滑动到底部" class="sidebar-link">使小程序自动滑动到底部</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#scroll-view-横向滚动时-无法滚动" class="sidebar-link">scroll-view 横向滚动时 无法滚动</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#视频页分享后，没有自动播放" class="sidebar-link">视频页分享后，没有自动播放</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序使用-echarts-问题" class="sidebar-link">小程序使用 echarts 问题</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#数组单独赋值改变数据" class="sidebar-link">数组单独赋值改变数据</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序浮层、底部页面滑动穿透问题" class="sidebar-link">小程序浮层、底部页面滑动穿透问题</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序-image-组件-binderr-事件" class="sidebar-link">小程序 image 组件 binderr 事件</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序-scroll-view-组件-横向滚动" class="sidebar-link">小程序  scroll-view 组件 横向滚动</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序音频api问题例如：切换页面无法暂停、退出后没有销毁" class="sidebar-link">小程序音频api问题例如：切换页面无法暂停、退出后没有销毁</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#小程序视频或音频出现报错-uncaught-in-promise-aborterror-the-play-request-was-interrupted-by-a-call-to-pause" class="sidebar-link">小程序视频或音频出现报错 Uncaught (in promise) AbortError: The play() request was interrupted by a call to pause()</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#短信倒计时" class="sidebar-link">短信倒计时</a></li><li class="sidebar-sub-header"><a href="/blog/mini-program.html#订单倒计时" class="sidebar-link">订单倒计时</a></li></ul></li><li><a href="/blog/mini-program.html#小程序云开发" class="sidebar-link">小程序云开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mini-program.html#云函数翻页" class="sidebar-link">云函数翻页</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#小程序">小程序</a><ul><li><a href="#async-await">async await</a></li><li><a href="#小程序使用字体图标">小程序使用字体图标</a></li><li><a href="#wxs-过滤器">wxs 过滤器</a></li><li><a href="#wxs-时间格式化-过滤器-兼容ios">wxs 时间格式化 过滤器 兼容ios</a></li><li><a href="#newdate-在ios-问题">newDate()  在ios 问题</a></li><li><a href="#使小程序自动滑动到底部">使小程序自动滑动到底部</a></li><li><a href="#scroll-view-横向滚动时-无法滚动">scroll-view 横向滚动时 无法滚动</a></li><li><a href="#视频页分享后，没有自动播放">视频页分享后，没有自动播放</a></li><li><a href="#小程序使用-echarts-问题">小程序使用 echarts 问题</a></li><li><a href="#数组单独赋值改变数据">数组单独赋值改变数据</a></li><li><a href="#小程序浮层、底部页面滑动穿透问题">小程序浮层、底部页面滑动穿透问题</a></li><li><a href="#小程序-image-组件-binderr-事件">小程序 image 组件 binderr 事件</a></li><li><a href="#小程序-scroll-view-组件-横向滚动">小程序  scroll-view 组件 横向滚动</a></li><li><a href="#小程序音频api问题例如：切换页面无法暂停、退出后没有销毁">小程序音频api问题例如：切换页面无法暂停、退出后没有销毁</a></li><li><a href="#小程序视频或音频出现报错-uncaught-in-promise-aborterror-the-play-request-was-interrupted-by-a-call-to-pause">小程序视频或音频出现报错 Uncaught (in promise) AbortError: The play() request was interrupted by a call to pause()</a></li><li><a href="#短信倒计时">短信倒计时</a></li><li><a href="#订单倒计时">订单倒计时</a></li></ul></li><li><a href="#小程序云开发">小程序云开发</a><ul><li><a href="#云函数翻页">云函数翻页</a></li></ul></li></ul></div><p></p> <h2 id="小程序"><a href="#小程序" aria-hidden="true" class="header-anchor">#</a> 小程序</h2> <h3 id="async-await"><a href="#async-await" aria-hidden="true" class="header-anchor">#</a> async await</h3> <ol><li>目前(20190424)小程序已经支持async语法，但需要取消编辑器中 <code>es6 转 es5</code>的选项，但如果项目中用了 <code>解构语法</code> 同样会存在问题，两者不能兼得。</li></ol> <p>为了兼容解构语法，勾选 <code>es6 转 es5</code> 会报这个错误</p> <div class="danger custom-block"><p class="custom-block-title">error</p> <p>ReferenceError: regeneratorRuntime is not defined</p></div> <p>但按照网上搜索的答案：</p> <div class="tip custom-block"><p class="custom-block-title">answer</p> <p>npm i regenerator-runtime  并在用到的页面进行  import regeneratorRuntime from &quot;regenerator-runtime&quot;</p></div> <p>但还是会</p> <div class="danger custom-block"><p class="custom-block-title">error</p> <p>sdk uncaught third Error
Function(...) is not a function ....</p></div> <p>是因为在 <code>regenerator-runtime</code> 版本升级导致在小程序环境出问题（动态 Function）</p> <div class="tip custom-block"><p class="custom-block-title">end</p> <p>锁定到0.12.1版本可以解决上述 async 问题</p></div> <p>这个坑，真的找了很久~</p> <p>最后 引用一下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import regeneratorRuntime from './../../lib/runtime'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://www.npmjs.com/package/runtime" target="_blank" rel="noopener noreferrer">相关链接:npm-runtime<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/dcloudio/uni-app/issues/256" target="_blank" rel="noopener noreferrer">相关链接:微信小程序使用async语法出现错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="小程序使用字体图标"><a href="#小程序使用字体图标" aria-hidden="true" class="header-anchor">#</a> 小程序使用字体图标</h3> <ol><li><p>在阿里图标库选择相应的字体图标添加到图标库，具体步骤省略</p></li> <li><p>点击在线链接，获取字体图标链接，并下载该文件</p></li></ol> <p><img src="/assets/img/mini-program1.92cba132.png" alt="图片找不到了"></p> <ol start="3"><li><p>将获取的在线链接复制到 <code>app.wxss</code> 中</p></li> <li><p>将下载文件中 <code>iconfont.css</code> 中的字体图标类名复制到 <code>app.wxss</code> 中</p></li></ol> <p><img src="/assets/img/mini-program2.a16ab158.png" alt="图片找不到了"></p> <ol start="5"><li>在 <code>.wxml</code> 中可以使用了</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;text class=&quot;iconfont icon-meirixiaoshuobaobiao&quot;&gt;&lt;text&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://blog.csdn.net/markkr133/article/details/80287954" target="_blank" rel="noopener noreferrer">相关链接：微信小程序中使用阿里（iconfont）字体图标<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="wxs-过滤器"><a href="#wxs-过滤器" aria-hidden="true" class="header-anchor">#</a> wxs 过滤器</h3> <blockquote><p>*注意:**wxs 获取当前日期不可以使用 new Date()，而需要使用 getDate() 代替</p></blockquote> <p><a href="https://blog.csdn.net/tianxintiandisheng/article/details/82086258" target="_blank" rel="noopener noreferrer">相关链接：微信小程序设置过滤器将时间戳转化为时间字符串<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="wxs-时间格式化-过滤器-兼容ios"><a href="#wxs-时间格式化-过滤器-兼容ios" aria-hidden="true" class="header-anchor">#</a> wxs 时间格式化 过滤器 兼容ios</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  munFormat: function (num, dig = 2) {
    return num.toFixed(dig);
  },
  dateFormat: function (strDate, format = &quot;yyyy-MM-dd hh:mm:ss&quot;) {
    // 解决ios出现NaN问题
    var realDate = strDate ? getDate(strDate.replace(getRegExp('-', 'g'), '/')) : getDate();
    var regYear = getRegExp(&quot;(y+)&quot;, &quot;i&quot;);
    var date = [
      [&quot;M+&quot;, realDate.getMonth() + 1],
      [&quot;d+&quot;, realDate.getDate()],
      [&quot;h+&quot;, realDate.getHours()],
      [&quot;m+&quot;, realDate.getMinutes()],
      [&quot;s+&quot;, realDate.getSeconds()],
      [&quot;q+&quot;, Math.floor((realDate.getMonth() + 3) / 3)],
      [&quot;S+&quot;, realDate.getMilliseconds()],
    ];
    var reg1 = regYear.exec(format);
    if (reg1) {
      format = format.replace(reg1[1], (realDate.getFullYear() + '').substring(4 - reg1[1].length));
    }
    for (var i = 0; i &lt; date.length; i++) {
      var reg2 = getRegExp(&quot;(&quot; + date[i][0] + &quot;)&quot;).exec(format);
      if (reg2) {
        format = format.replace(reg2[1], reg2[1].length == 1 ? v : (&quot;00&quot; + date[i][1]).substring((&quot;&quot; + date[i][1]).length));
      }
    }
    return format;
  }
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><a href="https://www.520mwx.com/view/33281" target="_blank" rel="noopener noreferrer">相关链接：小程序 时间格式化 过滤器 wxs（兼容ios）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="newdate-在ios-问题"><a href="#newdate-在ios-问题" aria-hidden="true" class="header-anchor">#</a> newDate()  在ios 问题</h3> <p>ios转换时间戳会出现 <code>NaN</code> 因为在ios 小程序获取不到对应的时间对象</p> <p>解决:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Date.parse(&quot;2019-07-19 11:25:21&quot;.replace(/-/g,&quot;/&quot;));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://developers.weixin.qq.com/community/develop/article/doc/00066e87a4cd804f2a39aa04b51413" target="_blank" rel="noopener noreferrer">相关链接：微信小程序开发new Date()在IOS注意点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="使小程序自动滑动到底部"><a href="#使小程序自动滑动到底部" aria-hidden="true" class="header-anchor">#</a> 使小程序自动滑动到底部</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 获取容器高度，使页面滚动到容器底部
  pageScrollToBottom: function() {
    wx.createSelectorQuery().select('#j_page').boundingClientRect(function(rect){
      // 使页面滚动到底部
      wx.pageScrollTo({
        scrollTop: rect.bottom
      })
    }).exec()
  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a href="https://segmentfault.com/q/1010000012493589/a-1020000012493975" target="_blank" rel="noopener noreferrer">相关链接：小程序里如何使页面自动滚动到底部？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="scroll-view-横向滚动时-无法滚动"><a href="#scroll-view-横向滚动时-无法滚动" aria-hidden="true" class="header-anchor">#</a> scroll-view 横向滚动时 无法滚动</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>scroll-view的style: display: flex; white-space: nowrap;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://developers.weixin.qq.com/community/develop/doc/0008e4840a0b58022409f280b5b800?highLine=scroll-view%2520%25E6%25A8%25AA%25E5%2590%2591" target="_blank" rel="noopener noreferrer">相关链接：在学习scroll-view组件横向滚动的时候遇到的无法滚动的问题？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="视频页分享后，没有自动播放"><a href="#视频页分享后，没有自动播放" aria-hidden="true" class="header-anchor">#</a> 视频页分享后，没有自动播放</h3> <p>可以尝试用定时器延时加载</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// this[videoContext].play()</span>
<span class="token comment">// 兼容ios视频展示时无法播放问题</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">[</span>videoContext<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="小程序使用-echarts-问题"><a href="#小程序使用-echarts-问题" aria-hidden="true" class="header-anchor">#</a> 小程序使用 echarts 问题</h3> <h4 id="层级问题"><a href="#层级问题" aria-hidden="true" class="header-anchor">#</a> 层级问题</h4> <p>小程序使用echarts时，如果存在切换图表操作，可以使用一个 <code>echarts</code> 组件，传入不同数据进行渲染；但如果在图标上层显示一些信息</p> <p>小程序官方提供的组件 <code>cover-view</code> 可以暂时解决 <code>canvas</code> 层级最高的问题</p> <h4 id="隐藏显示切换的问题"><a href="#隐藏显示切换的问题" aria-hidden="true" class="header-anchor">#</a> 隐藏显示切换的问题</h4> <p>在使用echarts的时候，进行隐藏切换时，使用 <code>wx:if</code> 进行第二次渲染的时候，会有报错</p> <div class="tip custom-block"><p class="custom-block-title">解决方案</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;view class=&quot;daily-record-item daily-record-main&quot; hidden=&quot;{{!hasDaily}}&quot;&gt;&lt;/view&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 <code>hidden</code> 进行隐藏显示的切换</p></div> <p><a href="https://github.com/ecomfe/echarts-for-weixin/issues/40" target="_blank" rel="noopener noreferrer">相关链接：echarts 图表在隐藏后显示不出来<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="数组单独赋值改变数据"><a href="#数组单独赋值改变数据" aria-hidden="true" class="header-anchor">#</a> 数组单独赋值改变数据</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>const currentKey = `orderList[${index}].detail[${idx}].actualReceiptNum`

this.setData({
  [currentKey]: this.data.orderList[index].detail[idx].actualReceiptNum - 1
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>单独修改数组中每一条数据，而不是将整个数组重新赋值，导致页面数据全部重新渲染，提升性能</p></div> <h3 id="小程序浮层、底部页面滑动穿透问题"><a href="#小程序浮层、底部页面滑动穿透问题" aria-hidden="true" class="header-anchor">#</a> 小程序浮层、底部页面滑动穿透问题</h3> <p>底部的页面有滚动条，在自定义组件创建遮罩层时，底部页面仍然会滑动</p> <ol><li>浮层无滑动情况</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 小程序
catchtouchmove=&quot;true&quot;
// mpvue 
@touchmove.stop.prevent=&quot;moveHandle&quot;

methods: {
	moveHandle () {}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>浮层存在滑动情况</li></ol> <p>在弹出层出现的时候给底部的containerView加上一个class，消失的时候移除。
这种方法简单有效，但会改变页面原本滚动的位置（会滚动到顶部）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;view class=&quot;{{showMask?'not-scroll':''}}&quot;&gt;

.not-scroll{
  top:0px;
  left: 0px;
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: fixed;
  z-index: 0;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><a href="https://blog.csdn.net/idomyway/article/details/97025421" target="_blank" rel="noopener noreferrer">相关链接:微信小程序 - 解决自定义添加遮罩层，底部页面仍滚动<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.cnblogs.com/fayin/p/8461847.html" target="_blank" rel="noopener noreferrer">相关链接:[bug]小程序弹出层滚动穿透问题修复<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="小程序-image-组件-binderr-事件"><a href="#小程序-image-组件-binderr-事件" aria-hidden="true" class="header-anchor">#</a> 小程序 image 组件 binderr 事件</h3> <p>小程序在列表循环时，可能会出现图片文件加载失败现象，所以会出现错误</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;image src=&quot;{{item.pictureUrl}}&quot; binderror=&quot;showDefault&quot; mode=&quot;aspectFit&quot;&gt;&lt;/image&gt;

showDefault(e){
  let index = Number(e.currentTarget.dataset.index);
  let item = `shopList[${index}].pictureUrl`;
  this.setData({
    [item]:''
  })
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>加载失败时，执行showdefault方法，将数组的某一项的pictureUrl 为空</p> <p><a href="https://www.jianshu.com/p/fb9165d56fd2" target="_blank" rel="noopener noreferrer">微信小程序实例：image组件的binderror事件处理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="小程序-scroll-view-组件-横向滚动"><a href="#小程序-scroll-view-组件-横向滚动" aria-hidden="true" class="header-anchor">#</a> 小程序  scroll-view 组件 横向滚动</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;scroll-view scroll-x=&quot;{{true}}&quot; class=&quot;together-content&quot; style=&quot;width: 100%;&quot;&gt;
  &lt;view class=&quot;together-content-item&quot;&gt;
    &lt;view class=&quot;together-content-item-heart&quot;&gt;
      &lt;text class=&quot;heart-icon bg-normal&quot; style=&quot;background-image: url('{{image.Icon.smallHeart}}');&quot;&gt;&lt;/text&gt;
      &lt;text class=&quot;heart-normal-icon bg-normal&quot; style=&quot;background-image: url('{{image.Icon.heartWhite}}');&quot;&gt;&lt;/text&gt;
      &lt;text&gt;234&lt;/text&gt;
    &lt;/view&gt;
    &lt;view class=&quot;together-content-item-user&quot;&gt;
      &lt;text class=&quot;user-header bg-normal&quot; style=&quot;background-image: url('{{image.Icon.heartWhite}}');&quot;&gt;&lt;/text&gt;
      &lt;text class=&quot;user-name&quot;&gt;Moppy&lt;/text&gt;
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/scroll-view&gt;


.together-content {
  color: #ffffff;
  padding-left: 32rpx;
  padding-bottom: 76rpx;
  margin-top: 30rpx;
  display: flex;
  white-space: nowrap;
}
.together-content-item {
  display: inline-block;
  width: 200rpx;
  height: 266rpx;
  background: rgba(164,164,164,1);
  box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.05);
  border-radius: 30rpx;
  position: relative;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><code>white-space: nowrap;</code> 跟 <code>display: inline-block;</code>  要有</p> <p><a href="https://developers.weixin.qq.com/community/develop/doc/0008e4840a0b58022409f280b5b800?highLine=scroll-view%2520%25E6%25A8%25AA%25E5%2590%2591" target="_blank" rel="noopener noreferrer">相关链接：遇到的无法滚动的问题……<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="小程序音频api问题例如：切换页面无法暂停、退出后没有销毁"><a href="#小程序音频api问题例如：切换页面无法暂停、退出后没有销毁" aria-hidden="true" class="header-anchor">#</a> 小程序音频api问题例如：切换页面无法暂停、退出后没有销毁</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">onLoad</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createInnerAudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">onPlay</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isAudioPlay<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isAudioPlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isAudioPlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        isAudioPlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        currentAudioTimeDec<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>audioTimeDec
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">onTimeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        currentAudioTime<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isAudioPlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onHide</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onUnload</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Audio<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>在写音频时，遇到了切换页面或再次进入页面时，音频叠加播放，以及无法销毁等原因，经过调试后，发现问题</p> <p>onhide只有在页面隐藏，并没有销毁的情况下执行，所以如果切换页面想让音频停止播放，只需在onhide周期执行pause即可</p> <p>onupload只有在页面卸载时执行，所以在卸载时销毁生成的音频组件</p> <p>音频监听方法及创建实例仅需要在onload执行，如果在show执行，则可能存在多个线程实例，无法控制</p> <p><a href="https://blog.csdn.net/qq_41226029/article/details/95346514" target="_blank" rel="noopener noreferrer">相关链接：微信小程序--解决wx.createInnerAudioContext无法停止播放问题 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="小程序视频或音频出现报错-uncaught-in-promise-aborterror-the-play-request-was-interrupted-by-a-call-to-pause"><a href="#小程序视频或音频出现报错-uncaught-in-promise-aborterror-the-play-request-was-interrupted-by-a-call-to-pause" aria-hidden="true" class="header-anchor">#</a> 小程序视频或音频出现报错 Uncaught (in promise) AbortError: The play() request was interrupted by a call to pause()</h3> <p>问题的所在是：执行了play()方法以后立即执行了pause()方法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>video<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>延迟进行下一步操作</p> <p><a href="https://segmentfault.com/q/1010000007130230" target="_blank" rel="noopener noreferrer">相关链接：控制台报错： The play() request was interrupted by a call to pause() <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="短信倒计时"><a href="#短信倒计时" aria-hidden="true" class="header-anchor">#</a> 短信倒计时</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;send-message {{(phoneNumber &amp;&amp; phoneNumber.length == 11) ? 'active' : ''}}&quot;</span> bind<span class="token punctuation">:</span>tap<span class="token operator">=</span><span class="token string">&quot;getMessageCode&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token punctuation">(</span>seconds<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> seconds<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token operator">?</span>seconds <span class="token punctuation">:</span> <span class="token string">'获取验证码'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token function">timeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>seconds <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        seconds<span class="token punctuation">:</span><span class="token number">60</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      seconds<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>seconds<span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="订单倒计时"><a href="#订单倒计时" aria-hidden="true" class="header-anchor">#</a> 订单倒计时</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">countDownHandler</span> <span class="token punctuation">(</span>startTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _that <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// this.startTime = startTime || '';</span>
  <span class="token comment">// 兼容ios时间问题</span>
  startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>startTime<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/-/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 轮询计算时间</span>
  <span class="token keyword">let</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// var that = this;</span>
      <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 格式化时分秒</span>
  <span class="token keyword">let</span> <span class="token function-variable function">formatDuring</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>mss<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> hours <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mss <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> minutes <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mss <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> seconds <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mss <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> hours <span class="token operator">+</span> <span class="token string">&quot;小时&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>minutes <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span><span class="token operator">+</span>minutes <span class="token punctuation">:</span> minutes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;分钟&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>seconds <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span><span class="token operator">+</span>seconds <span class="token punctuation">:</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 初始化倒计时</span>
  <span class="token keyword">let</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> endTime <span class="token operator">=</span> startTime<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束时间 </span>
      <span class="token keyword">let</span> timeLeft <span class="token operator">=</span> endTime <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 剩余时间</span>
      <span class="token keyword">let</span> deadLineTime <span class="token operator">=</span> <span class="token function">formatDuring</span><span class="token punctuation">(</span>timeLeft<span class="token punctuation">)</span>
      _that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>deadLineTime<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// document.getElementById(this.el).innerHTML = this.formatDuring(timeLeft);</span>
      <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="小程序云开发"><a href="#小程序云开发" aria-hidden="true" class="header-anchor">#</a> 小程序云开发</h2> <h3 id="云函数翻页"><a href="#云函数翻页" aria-hidden="true" class="header-anchor">#</a> 云函数翻页</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>const cloud = require('wx-server-sdk')
exports.main = async (event, context) =&gt; {
  const wxContext = cloud.getWXContext()
  const dbName = event.dbName
  const filter = event.filter ? event.filter : null
  const pageIndex = event.pageIndex ? event.pageIndex : 1
  const pageSize = event.pageSize ? event.pageSize : 10
  const countResult = await db.collection(dbName).where(filter).count()
  const total = countResult.total
  const totalPage = Math.ceil(total / 10)
  let hasMore
  if (pageIndex &gt; totalPage || pageIndex === totalPage) {
    hasMore = false
  } else {
    hasMore = true
  }

  return db.collection(dbName).where(filter).skip((pageIndex - 1) * pageSize).orderBy('creat_time', 'desc').limit(pageSize).get()
    .then(res =&gt; {
      res.pageIndex = pageIndex
      res.pageSize = pageSize
      res.totalPage = totalPage
      res.hasMore = hasMore
      return res
    })
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/2/2020, 11:21:30 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.d56d54d5.js" defer></script><script src="/assets/js/7.b09efff3.js" defer></script>
  </body>
</html>
